<div class="max-w-4xl mx-auto">
  <!-- Header -->
  <div class="text-center mb-8">
    <h1 class="text-4xl font-bold text-gray-800 mb-2">
      PacketFlow LLM Chat Demo
    </h1>
    <p class="text-gray-600">
      Experience PacketFlow's intent-context-capability system in action
    </p>
  </div>

  <!-- Chat Interface -->
  <div class="bg-white rounded-lg shadow-lg overflow-hidden">
    <!-- Chat Header -->
    <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4">
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-xl font-semibold">AI Assistant</h2>
          <p class="text-blue-100 text-sm">Powered by PacketFlow</p>
        </div>
        <div class="flex space-x-2">
          <button phx-click="new_chat" 
                  class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1 rounded text-sm transition-colors">
            New Chat
          </button>

          <button phx-click="toggle_admin_panel" 
                  class="bg-white bg-opacity-20 hover:bg-opacity-30 px-3 py-1 rounded text-sm transition-colors">
            Admin
          </button>
        </div>
      </div>
    </div>

    <!-- Messages Container -->
    <div class="h-96 overflow-y-auto p-4 space-y-4">
      <%= for message <- Enum.reverse(@messages) do %>
        <div class={"flex #{if message.role == :user, do: "justify-end", else: "justify-start"}"}>
          <div class="max-w-xs lg:max-w-md xl:max-w-lg 2xl:max-w-xl">
            <div class={"#{message_bubble_class(message.role)} p-3 rounded-lg"}>
              <p class="text-sm">
                <%= message.content %>
                <%= if Map.get(message, :is_streaming) do %>
                  <span class="inline-block w-2 h-4 bg-current opacity-75 animate-pulse ml-1">|</span>
                <% end %>
              </p>
            </div>
          </div>
        </div>
      <% end %>

      <!-- Typing indicator -->
      <%= if @is_typing do %>
        <div class="flex justify-start">
          <div class="max-w-xs lg:max-w-md xl:max-w-lg 2xl:max-w-xl">
            <div class="bg-gray-100 text-gray-800 p-3 rounded-lg">
              <div class="flex items-center space-x-2">
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                <span class="text-gray-500 text-sm ml-2">AI is thinking...</span>
              </div>
            </div>
          </div>
        </div>
      <% end %>


    </div>

    <!-- Input Area -->
    <div class="border-t border-gray-200 p-4">
      <form phx-submit="send_message" class="flex space-x-2">
        <input type="text" 
               name="message" 
               value={@current_message}
               phx-keyup="update_message"
               class="flex-1 border border-gray-300 rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
               placeholder="Type your message here..."
               autocomplete="off">
        <button type="submit" 
                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors">
          Send
        </button>

      </form>
    </div>
  </div>



  <!-- Admin Panel -->
  <%= if @show_admin_panel do %>
    <div class="mt-8 bg-white rounded-lg shadow-lg p-6">
      <h3 class="text-xl font-semibold mb-4">Admin Panel</h3>
      <div class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">
            Model Configuration
          </label>
          <textarea name="config"
                   class="w-full border border-gray-300 rounded-lg px-3 py-2 h-32"
                   placeholder='{"model": "gpt-3.5-turbo", "temperature": 0.7, "max_tokens": 1000}'></textarea>
        </div>
        <button phx-click="update_config" 
                class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
          Update Configuration
        </button>
      </div>
    </div>
  <% end %>
</div>
